<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/homepage.css" />
    <!-- <link rel="stylesheet" href="/css/profile.css"/> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
        integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
        integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="
        crossorigin="anonymous" />

    <title>Home page</title>
</head>

<body>
    <div class="container_main">

        <div class="home_row">
            <div class="home_tab1">

                <section>
                    <div class="flexdata">
                        <!-- sidebar starts -->
                        <div class="sidebar">
                            <svg class="svg-icon2"
                                style="width: 3em; height: 3em;vertical-align: middle;fill: currentColor;overflow: hidden;"
                                viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M962.267429 233.179429q-38.253714 56.027429-92.598857 95.451429 0.585143 7.972571 0.585143 23.990857 0 74.313143-21.723429 148.260571t-65.974857 141.970286-105.398857 120.32-147.456 83.456-184.539429 31.158857q-154.843429 0-283.428571-82.870857 19.968 2.267429 44.544 2.267429 128.585143 0 229.156571-78.848-59.977143-1.170286-107.446857-36.864t-65.170286-91.136q18.870857 2.852571 34.889143 2.852571 24.576 0 48.566857-6.290286-64-13.165714-105.984-63.707429t-41.984-117.394286l0-2.267429q38.838857 21.723429 83.456 23.405714-37.741714-25.161143-59.977143-65.682286t-22.308571-87.990857q0-50.322286 25.161143-93.110857 69.12 85.138286 168.301714 136.265143t212.260571 56.832q-4.534857-21.723429-4.534857-42.276571 0-76.580571 53.979429-130.56t130.56-53.979429q80.018286 0 134.875429 58.294857 62.317714-11.995429 117.174857-44.544-21.138286 65.682286-81.115429 101.741714 53.174857-5.705143 106.276571-28.598857z"
                                    fill="#857df9" />
                            </svg>

                            <div class="nav_link">
                                <div class="sidebarOption active">
                                    <p class="material-icons"> home </p>     
                                    <a href="/login/login" class="tryhover">Home</a>
                                </div>
    
    
                                <div class="sidebarOption">
                                    <span class="material-icons"> perm_identity </span>
                                    <a href="/prof/prof">Profile</a>
                                </div>
    
                                <div id="manuopt" onclick="dataopt()" class="sidebarOption">
                                    <span class="material-icons"> more_horiz </span>
                                    <a href="/prof/prof">More</a>
                                </div>
                            </div>

                            
                            <div class="tweet_btn">
                                <a href="/tweet/tweet_add" class="sidebar__tweet">Tweet</a>
                            </div>
                        </div>


                        <div class="bottom-stick">
                           <div>
                              <img src="/files/dbdesign.jpeg" alt="" class="user_img">  
                           </div>
                           <div class="user_name">
                                <h4>Name</h4>
                                <p>email</p>
                           </div>

                        </div>
                    </div>
                </section>


            </div>

            <div class="home_tab2">
                <section>
                    <div class="home">
                        <h2>Home</h2>
                    </div>
                    <div class="container">
                        <% const array_of_allowed_files=['png', 'jpeg' , 'jpg' ]; const
                            array_of_allowed_videos=['mp4','gif']; %>
                            <% for(var i=0;i<data.length;i++) { %>
                                <% var flag=0%>
                                
                                    <div class="tweet">
                                        <div class="test_col_row">
                                            <div class="text_col1">
                                                <div class="img1"><img src="/files/profile-img.png"></div>
                                            </div>
                                            <div class="text_col2">
                                                <p id="tweetid" hidden>
                                                    <%=data[i].id%>
                                                </p>
                                                <a href="">Jaquon Hart</a>
                                                <p>
                                                    <%=data[i].heading%>
                                                </p>
                                                <p class="skill">
                                                    <%=data[i].description%>
                                                </p>
                                                <% if(data[i].media_url==null) { console.log("nothing") }else{ const
                                                    file_extension=data[i].media_url.slice(((data[i].media_url.lastIndexOf('.')
                                                    - 1)>>> 0) + 2);
                                                    if (array_of_allowed_files.includes(file_extension)) {
                                                    %>
                                                    <img id="tweet_img" src="<%=data[i].media_url%>" />
                                                    <% }else{ %>
                                                        <video width="320" height="240" controls>
                                                            <source src="<%=data[i].media_url%>" type="video/mp4">
                                                        </video>
                                                        <% }}%>
                                                            <div class="icon">
                                                                <div class="insta">
                                                                    <div class="icon_row">
                                                                        <% for(let j=0;j<tweetid.length;j++){%>
                                                                            <% if(data[i].id==tweetid[j]){%>
                                                                                <a id="likeCount<%=data[i].id%>"
                                                                                    href="/likes/likes2">
                                                                                    <%=likecount[j]%>
                                                                                </a>
                                                                                <i id="<%=data[i].id%>"
                                                                                    class="like_d fa fa-thumbs-up"
                                                                                    onclick="likepost(this.id,1)"></i>
                                                                                <%flag=1%>
                                                                                    <%}%>
                                                                                        <%}%>
                                                                                            <%if(flag !=1){%>
                                                                                                <a id="likeCount<%=data[i].id%>"
                                                                                                    href="/likes/likes2">0</a>
                                                                                                <i id="<%=data[i].id%>"
                                                                                                    class="like_c fa fa-thumbs-up"
                                                                                                    onclick="likepost(this.id,0)"></i>
                                                                                                <%}%>
                                                                                                    <div
                                                                                                        class="icon_row">
                                                                                                        <div
                                                                                                            class="icon_col">
                                                                                                            <a
                                                                                                                href="/comment/newc?tid=<%=data[i].id%>&u_id=<%=data[i].u_id%>"><i
                                                                                                                    class="fas fa-comment"></i></a>
                                                                                                            
                                                                                                        </div>

                                                                                                        <div
                                                                                                            class="icon_row">
                                                                                                            <div
                                                                                                                class="icon_col">
                                                                                                                <a href=""><i class="fa fa-retweet"></i></a>
                                                                                                                
                                                                                                            </div>
                                                                                                        </div>
                                                                                                    </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                            </div>
                                        </div>
                                    </div>

                                    <% } %>




                                        <% for(var i=0;i<tweetfollowing.length;i++) { %>
                                            <% var flag=0%>
                                                <div class="tweet">
                                                    <div class="test_col_row">
                                                        <div class="text_col1">
                                                            <div class="img1"><img src="/files/profile-img.png"></div>
                                                        </div>
                                                        <div class="text_col2">
                                                            <p id="tweetid">
                                                                <%=tweetfollowing[i].id%>
                                                            </p>
                                                            <a href="">Jaquon Hart</a>
                                                            <p>
                                                                <%=tweetfollowing[i].heading%>
                                                            </p>
                                                            <p class="skill">
                                                                <%=tweetfollowing[i].description%>
                                                            </p>
                                                            <% if(tweetfollowing[i].media_url==null) {
                                                                console.log("nothing") }else{ const
                                                                file_extension=tweetfollowing[i].media_url.slice(((tweetfollowing[i].media_url.lastIndexOf('.')
                                                                - 1)>>> 0) + 2);
                                                                if (array_of_allowed_files.includes(file_extension)) {
                                                                %>
                                                                <img id="tweet_img"
                                                                    src="<%=tweetfollowing[i].media_url%>" />
                                                                <% }else{ %>
                                                                    <video width="320" height="240" controls>
                                                                        <source src="<%=tweetfollowing[i].media_url%>"
                                                                            type="video/mp4">
                                                                    </video>
                                                                    <% }}%>
                                                                        <div class="icon">
                                                                            <div class="insta">
                                                                                <div class="icon_row">
                                                                                    <% for(let
                                                                                        j=0;j<tweetid.length;j++){%>
                                                                                        <%
                                                                                            if(tweetfollowing[i].id==tweetid[j]){%>
                                                                                            <a id="likeCount<%=tweetfollowing[i].id%>"
                                                                                                href="/likes/likes2">
                                                                                                <%=likecount[j]%>
                                                                                            </a>
                                                                                            <i id="<%=tweetfollowing[i].id%>"
                                                                                                class="like_d fa fa-thumbs-up"
                                                                                                onclick="likepost(this.id,1)"></i>
                                                                                            <%flag=1%>
                                                                                                <%}%>
                                                                                                    <%}%>
                                                                                                        <%if(flag
                                                                                                            !=1){%>
                                                                                                            <a id="likeCount<%=tweetfollowing[i].id%>"
                                                                                                                href="/likes/likes2">0</a>
                                                                                                            <i id="<%=tweetfollowing[i].id%>"
                                                                                                                class="like_c fa fa-thumbs-up"
                                                                                                                onclick="likepost(this.id,0)"></i>
                                                                                                            <%}%>
                                                                                                                <div
                                                                                                                    class="icon_row">
                                                                                                                    <div
                                                                                                                        class="icon_col">
                                                                                                                        <a
                                                                                                                            href="/comment/newc?tid=<%=tweetfollowing[i].id%>&u_id=<%=tweetfollowing[i].u_id%>"><i
                                                                                                                                class="fas fa-comment"></i></a>
                                                                                                                        <p>10
                                                                                                                        </p>
                                                                                                                    </div>

                                                                                                                    <div
                                                                                                                        class="icon_row">
                                                                                                                        <div
                                                                                                                            class="icon_col">
                                                                                                                            <a
                                                                                                                                href=""><i
                                                                                                                                    class="fa fa-retweet"></i></a>
                                                                                                                            <p>10
                                                                                                                            </p>
                                                                                                                        </div>

                                                                                                                    </div>

                                                                                                                </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                        </div>
                                                    </div>
                                                </div>

                                                <% } %>

                    </div>
                </section>
            </div>

            <div class="home_tab3">

                <section>
                    <div class="col_search">

                        <div class="widgets">
                            <div class="widgets__input">
                                <span class="material-icons widgets__searchIcon">
                                    <i class="fa-solid fa-magnifying-glass"></i></span>
                                <input type="text" placeholder="Search" onkeyup="search(this.value)" />
                            </div>
                            <div>
                                <p id="searchresult"></p>
                            </div>
                        </div>
                    </div>
                </section>


            </div>
        </div>
    </div>
    <script>

        var followinguser = [];
        async function search(search_value) {
            var s = ""
            var search_result = await fetch(`/search/home?var=${search_value}`)
                .then(res => res.json())
                .then((arr) => {
                    console.log("searching list: ", arr);
                    console.log("searching listuser: ", arr.listUser);
                    console.log("searching following: ", arr.following[0]);
                    for (i = 0; i < arr.listUser.length; i++) {
                        s += `
                            <div class="searchprofile">
                                <div class="profileinfo1">
                                    <img src="/files/profile-img.png" alt="">
                                </div>
                                <div class="profileinfo2">
                                       <div class="name">
                                        <span>`+ arr.listUser[i].name + `</span>
                                        </div>
                                        <div class="email">
                                        <span>`+ arr.listUser[i].email + `</span>
                                         </div>
                                </div>
                                <div class="profileinfo3">
                                    <div class="followbtn">`;
                        for (let i = 0; i < arr.following.length; i++) {
                            followinguser.push(arr.following[i].following_id);
                        }
                        console.log("followinguser", followinguser);
                        console.log("followinguser.includes(arr.listUser[0].id)", arr.listUser[i].id)
                        if (followinguser.includes(arr.listUser[i].id)) {
                            s += ` <span onclick="follow(${arr.listUser[i].id},${1})" id="followbutton${arr.listUser[i].id}">UnFollow</span>`;

                        } else {
                            s += ` <span onclick="follow(${arr.listUser[i].id},${0})"  id="followbutton${arr.listUser[i].id}">Follow</span>`;
                        }

                        s += `
                                    </div>
                                  
                                </div>
                            </div>`;
                    }
                    document.getElementById('searchresult').innerHTML = s;


                })
            // console.log(search_value);
        }
        async function follow(id, follow_flag) {
            if (follow_flag == 0) {
                var following_btn = document.getElementById(`followbutton${id}`).innerHTML = "Unfollow";
                document.getElementById(`followbutton${id}`).setAttribute("onclick", `follow(${id},1)`);
                var follower_result = await fetch(`/search/follower?follower_id=${id}&flag=1`)



            }
            else {
                var following_btn = document.getElementById(`followbutton${id}`).innerHTML = "Follow";

                document.getElementById(`followbutton${id}`).setAttribute("onclick", `follow(${id},0)`);
                var follower_result = await fetch(`/search/follower?follower_id=${id}&flag=0`);


            }
        }


        async function likepost(id, like_flag) {
            if (like_flag == 0) {
                document.getElementById(`${id}`).style.color = "red"

                const like_result = await fetch(`/likes/likes2?tweet_id=${id}&like_flag=1`);
                const like_count = await like_result.json();
                document.getElementById(`likeCount${id}`).innerHTML = like_count.countLike;
                document.getElementById(`${id}`).setAttribute("onclick", (id, 1));
            }
            else {
                var like_btn = document.getElementById(`${id}`).style.color = "black"

                const like_result = await fetch(`/likes/likes2?tweet_id=${id}&like_flag=0`);
                const like_count = await like_result.json();
                document.getElementById(`likeCount${id}`).innerHTML = like_count.countLike;
                document.getElementById(`${id}`).setAttribute("onclick", (id, 0));
            }

        }

    </script>
</body>

</html>
